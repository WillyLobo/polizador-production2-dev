{% load numletras %}
{% load static %}
<div class="container-flex bg-body">
<div class="row g-0">
    <div class="col border">
        <div class="row g-0">
            <div class="col border"><b>ID:</b></div><div class="col border">{{object.certificado_obra.id}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Programa:</b></div><div class="col border">{{object.certificado_obra.obra_programa}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Convenio:</b></div><div class="col border">{{object.certificado_obra.obra_convenio|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Concepto:</b></div><div class="col border">{{object.certificado_obra.obra_nombre}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Grupo:</b></div><div class="col border">{{object.certificado_obra.obra_grupo|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Localidad:</b></div><div class="col border">{% for localidad in object.certificado_obra.obra_localidad_m.all %} {{localidad|join:", "}} {%endfor%}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Contratista:</b></div><div class="col border">{{object.certificado_obra.obra_empresa.empresa_nombre}}</div>
        </div>
    </div>    
    <div class="col">
        <div class="row g-0">
            <div class="col border"><b>Expediente:</b></div><div class="col border">{{object.certificado_obra.obra_expediente}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Compulsa:</b></div><div class="col border">{{object.certificado_obra.get_obra_licitacion_tipo_display}} N°{{object.certificado_obra.obra_licitacion_numero}}/{{object.certificado_obra.obra_licitacion_ano}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Resolución:</b></div><div class="col border">{{object.certificado_obra.obra_resolucion}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Fecha de Contrato:</b></div><div class="col border">{{object.certificado_obra.obra_fecha_contrato}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Nomenclatura Catastral:</b></div><div class="col border">{{object.certificado_obra.obra_nomenclatura|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Plazo de Ejecución:</b></div><div class="col border">{{object.certificado_obra.obra_plazo}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Inspector:</b></div><div class="col border">{%for inspector in object.certificado_obra.obra_inspector.all%}{{inspector|join:", "}}<br>{%endfor%}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Observaciones:</b></div><div class="col border">{{object.certificado_obra.obra_observaciones}}</div>
        </div>
    </div>
    <div class="col">
        <div class="row g-0">
            <div class="col border"><b>Monto Contrato Total(Pesos):</b></div><div class="col border">${{object.certificado_obra.obra_contrato_total_pesos|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Monto Contrato Total(UVI):</b></div><div class="col border">{{object.certificado_obra.obra_contrato_total_uvi|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Monto Nación(Pesos):</b></div><div class="col border">${{object.certificado_obra.obra_contrato_nacion_pesos|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Monto Nación(UVI):</b></div><div class="col border">{{object.certificado_obra.obra_contrato_nacion_uvi|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Fecha UVI:</b></div><div class="col border">{{object.certificado_obra.obra_contrato_nacion_uvi_fecha|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Monto Provincia(Pesos):</b></div><div class="col border">${{object.certificado_obra.obra_contrato_provincia_pesos|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Monto Provincia(UVI):</b></div><div class="col border">{{object.certificado_obra.obra_contrato_provincia_uvi|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Fecha UVI:</b></div><div class="col border">{{object.certificado_obra.obra_contrato_provincia_uvi_fecha|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><br></div><div class="col border"></div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Ultimo Acumulado en Pesos:</b></div><div class="col border">{{object.certificado_obra.obra_acum_pesos.certificado_monto_cobrar__sum|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Ultimo Acumulado en UVI:</b></div><div class="col border">{{object.certificado_obra.obra_acum_uvi.certificado_monto_cobrar_uvi__sum|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Saldo en UVI:</b></div><div class="col border">{{object.certificado_obra.saldo_uvi|default_if_none:"-"}}</div>
        </div>
        <div class="row g-0">
            <div class="col border"><b>Ultimo Acumulado Porcentual:</b></div><div class="col border">{{object.certificado_obra.certificado_set.latest.certificado_acum_pct|default_if_none:"-"}}</div>
        </div>
    </div>
    <div>
        {%for contrato in object.certificado_obra.contrato_set.all%}
        <div class="col">
            <div class="row g-0">
                <div class="col border"><b>Fecha de Firma:</b></div><div class="col border">{{contrato.contrato_fecha}}</div>
                <div class="col border"><b>Objeto:</b></div><div class="col border">{{contrato.contrato_descripcion}}</div>
                <div class="col border"><b>Resolución:</b></div><div class="col border">{{contrato.contrato_resolucion}}</div>
                <div class="col border"><b>Importado:</b></div><div class="col border">{{contrato.contrato_autocarga}}</div>
                <div class="col border"><b>Decreto Aprobatorio:</b></div><div class="col border">{{contrato.contrato_decreto|default_if_none:"-"}}</div>
                <div class="col border"><b>Editar:</b></div><div class="col border"><a href="{% url "carga:update-contrato" contrato.id %}">{{editimglink|safe}}</a></div>
            </div>
        </div>
            {%for contratomonto in contrato.contratomonto_set.all%}
        <div class="col">
            <div class="row g-0">
                <div class="col border"><b>Rubro:</b></div><div class="col border">{{contratomonto.contratomonto_rubro}}</div>
                <div class="col border"><b>Financiamiento:</b></div><div class="col border">{{contratomonto.contratomonto_financiamiento}}</div>
                <div class="col border"><b>Monto Pesos:</b></div><div class="col border">{{contratomonto.contratomonto_pesos}}</div>
                <div class="col border"><b>Monto UVI:</b></div><div class="col border">{{contratomonto.contratomonto_uvi}}</div>
                <div class="col border"><b>Fecha UVI:</b></div><div class="col border">{{contratomonto.contratomonto_uvi_fecha|default_if_none:"-"}}</div>
                <div class="col border"><b>Editar:</b></div><div class="col border"><a href="{% url "carga:update-contrato" contrato.id %}">{{editimglink|safe}}</a></div>
            </div>
        </div>
            {%endfor%}
            <div class="row g-0">
                <div class="col border"></div>
            </div>
        {%endfor%}
    </div>
    
    <table id="tablaObras" class="table table-bordered table-sm table-hover align-middle border border-dark data dataTables_wrapper">
    <thead>
        <tr>
            <th scope="col">ID#</th>
            <th scope="col">Expediente</th>
            <th scope="col">Ant. N°</th>
            <th scope="col">Obra N°</th>
            <th scope="col">Dev. N°</th>
            <th scope="col">Periodo</th>
            <th scope="col">Mes %</th>
            <th scope="col">Ant %</th>
            <th scope="col">Acu %</th>
            <th scope="col">Rubro</th>
            <th scope="col">Financiamiento</th>
            <th scope="col">Monto $</th>
            <th scope="col">Devolucion $</th>
            <th scope="col">Monto UVI</th>
            <th scope="col">Devolucion UVI</th>
            <th scope="col">Monto a Cobrar</th>
            <th scope="col">Monto a Cobrar UVI</th>
            <th scope="col">Digital</th>
        </tr>
    </thead>
    <tbody>
        {% for instance in object.certificado_obra.certificado_set.all|dictsort:"certificado_fecha" %}
        <tr>
            <th scope="row">{{instance.id}}</th>
            <td>{{instance.certificado_expediente}}</td>
            <td>{{instance.certificado_rubro_anticipo}}</td>
            <td>{{instance.certificado_rubro_obra}}</td>
            <td>{{instance.certificado_rubro_devanticipo}}</td>
            <td>{{instance.certificado_fecha|date:"M-Y"}}</td>
            <td>{{instance.certificado_mes_pct}}</td>
            <td>{{instance.certificado_ante_pct}}</td>
            <td>{{instance.certificado_acum_pct}}</td>
            <td>{{instance.certificado_rubro_db.certificadorubro_nombre}}</td>
            <td>{{instance.get_certificado_financiamiento_display}}</td>
            <td>{{instance.certificado_monto_pesos}}</td>
            <td>{{instance.certificado_devolucion_monto}}</td>
            <td>{{instance.certificado_monto_uvi}}</td>
            <td>{{instance.certificado_devolucion_monto_uvi}}</td>
            <td>{{instance.certificado_monto_cobrar}}</td>
            <td>{{instance.certificado_monto_cobrar_uvi}}</td>
            {% if instance.certificado_digital %}
            <td class="d-print-none"><a href="{{instance.certificado_digital.url}}">{{pdfimglink|safe}}</a></td>
            {% else %}
            <td>{{nofileimglink|safe}}</td>
            {% endif %}
            {% if perms.carga.change_certificado %}
            <td class="d-print-none"><a href="{% url "carga:update-certificado" instance.id %}">{{editimglink|safe}}</td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col"></th>
            <th scope="col">Totales</th>
            <th id="totalPesos" scope="col">Monto $</th>
            <th id="totalDevolucion" scope="col">Devolucion</th>
            <th id="totalUvi" scope="col">Monto UVI</th>
            <th id="totalDevolucionUvi" scope="col">Devolucion UVI</th>
            <th id="montoCobrar" scope="col">Monto a Cobrar</th>
            <th id="montoCobrarUvi" scope="col">Monto a Cobrar UVI</th>
            <th scope="col"> </th>
        </tr>
    </tfoot>
</table>
</div>

<script>
    sumaColumnaPesos("tablaObras", 11, "totalPesos");
    sumaColumnaPesos("tablaObras", 12, "totalDevolucion");
    sumaColumnaUvi("tablaObras", 13, "totalUvi");
    sumaColumnaUvi("tablaObras", 14, "totalDevolucionUvi");
    sumaColumnaPesos("tablaObras", 15, "montoCobrar");
    sumaColumnaUvi("tablaObras", 16, "montoCobrarUvi");
</script>